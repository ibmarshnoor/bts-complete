<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="stylesheet"
	href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
<script
	src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
<script
	src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.min.js"></script>
<script
	src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
<title>Create Bug</title>
<script type="text/javascript">
	function createBug() {
		function success(response){
			if(!response.ok){
				alert("error happened");
				return;
			}
			return response.json();
		}
		const bugform=document.getElementById('bugform');
		if(!bugform.checkValidity()){
			alert('form is invalid');
			return;
		}
		const eta=document.getElementById("eta").value;
		const etadate=new Date(eta);
		const dateToday=new Date();
		if(etadate<dateToday ||eta==""){
			alert("ETA date should be future date");
		}
		const descriptionCheck=document.getElementById("description").value;
		if(descriptionCheck.length<10){
			alert("Minimum length 10 for description");
		}
		
		const promise=fetch("/bug", {
			method : 'POST',
			headers : {
				'Content-Type' : 'application/json'
			},
			body : JSON.stringify({
				name : document.getElementById('name').value,
				priority : document.getElementById('priority').value,
				status : document.getElementById('status').value,
				module : document.getElementById('module').value,
				projectId : document.getElementById('projectid').value,
				product : document.getElementById('product').value,
				synopsis : document.getElementById('synopsis').value,
				description : document.getElementById('description').value,
				buildVersion : document.getElementById('buildversion').value,
				testerId:document.getElementById('testerid').value,
				developerId:document.getElementById('developerid').value,
				severity:document.getElementById('severity').value,
				type:document.getElementById('type').value,
				etaDate:document.getElementById('eta').value,
				submittedOn:new Date()
			})
		});
		promise.then(success);
	}
</script>
</head>

<body class="jumbotron">
	<h1 style="text-align: center;">Bug-Tracking System</h1>
	<nav class="navbar navbar-expand-lg navbar-light bg-light">
		<a class="navbar-brand" href="#">BugTracker</a>
		<button class="navbar-toggler" type="button" data-toggle="collapse"
			data-target="#navbarSupportedContent"
			aria-controls="navbarSupportedContent" aria-expanded="false"
			aria-label="Toggle navigation">
			<span class="navbar-toggler-icon"></span>
		</button>
		<div class="collapse navbar-collapse" id="navbarNavAltMarkup">
			<div class="navbar-nav">
				<a class="nav-item nav-link active" href="homePageBug.html">Home
					<span class="sr-only">(current)</span>
				</a> <a class="nav-item nav-link" href="createBug.html">Create</a> <a
					class="nav-item nav-link" href="updateBug.html">Update</a> <a
					class="nav-item nav-link" href="viewBug.html">Search</a>
			 <a class="nav-item nav-link" href="help.html">Help</a>
			</div>
		</div>
	</nav>
	<br>
	<div class="form-check">
		<h3>Create Bug</h3>
		<br>
		<form id="bugform">
			<p style="color: red">Required fields*</p>
			<div class="row">
				<div class="col-sm">
					<label>Name*</label> <input type="text" id="name"
						placeholder="Enter Name" class="col-sm-5 form-control" required
						maxlength="15"> 
						<br> <label>ETA</label> <input type="date" id="eta"
						class="col-sm-5 form-control"> <br>
						 <label>Description*</label>
					<textarea id="description" cols="30" rows="5"
						class="col-sm-5 form-control" required maxlength="200"></textarea>
					<br> <label>Type</label> <select id="type">
						<option value="RUN_TIME">Run-Time</option>
						<option value="COMPILE_TIME">Complie-Time</option>
					</select> <br> <label>Priority*</label> <select id="priority" required>
						<option value="LOW">Low</option>
						<option value="MEDIUM">Medium</option>
						<option value="HIGH">High</option>
					</select> <br> <label>Severity</label> <select id="severity">
						<option value="LOW">Low</option>
						<option value="MEDIUM">Medium</option>
						<option value="HIGH">High</option>
					</select> <br>
				</div>
				<div class="col-sm">
					<label>Module*</label> <input type="text" id="module"
						placeholder="Input" class="col-sm-5 form-control" required
						maxlength="15"> <br> <label>Status*</label><br>
					<select id="status" required>
						<option value="NEW">NEW</option>
						<option value="ASSIGNED">ASSIGNED</option>
						<option value="OPEN">OPEN</option>
						<option value="FIXED">FIXED</option>
						<option value="PENDING_RTEST">PENDING-RETEST</option>
						<option value="REOPEN">REOPEN</option>
						<option value="VERIFIED">VERIFIED</option>
						<option value="CLOSED">CLOSED</option>
						<option value="REJECTED">REJECTED</option>
						<option value="DUPLICATE">DUPLICATE</option>
						<option value="DEFERRED">DEFERRED</option>
						<option value="NOT_A_BUG">NOT-A-BUG</option>
					</select> <br> <br> <label>Build Version</label> <input
						type="text" id="buildversion" placeholder="Enter Build Verion"
						class="col-sm-5 form-control"  maxlength="15"> <br> <label>Product*</label>
					<input type="text" id="product" placeholder="Product"
						class="col-sm-5 form-control" required maxlength="15"> <br>
					<label>Project ID*</label> <input type="text" id="projectid"
						placeholder="ID" class="col-sm-5 form-control" required  maxlength="15">
				</div>
				<div class="col-sm">
					<label>Developer ID</label> <input type="number" id="developerid"
						placeholder="ID" class="col-sm-5 form-control"> <br>
					<label>Tester ID</label> <input type="number" id="testerid"
						placeholder="ID" class="col-sm-5 form-control">
					<br> <label>Synopsis*</label>
					<textarea id="synopsis" cols="30" rows="5"
						class="col-sm-5 form-control" required  maxlength="200"></textarea>
					
				</div>
			</div>
		</form>
	</div>

	<button onclick="createBug()" type="button" class="btn btn-primary">Submit</button>
	<br>

</body>
</html>